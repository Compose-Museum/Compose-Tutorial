<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">概述 | 你好 Compose</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://milklab.dev/docs/design/lists/overview"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="概述 | 你好 Compose"><meta data-react-helmet="true" name="description" content="许多应用程序需要显示项目的集合。本文解释了你如何在 Jetpack Compose 中有效地做到这一点。"><meta data-react-helmet="true" property="og:description" content="许多应用程序需要显示项目的集合。本文解释了你如何在 Jetpack Compose 中有效地做到这一点。"><link data-react-helmet="true" rel="icon" href="/img/logo.svg"><link data-react-helmet="true" rel="canonical" href="https://milklab.dev/docs/design/lists/overview"><link data-react-helmet="true" rel="alternate" href="https://milklab.dev/docs/design/lists/overview" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://milklab.dev/docs/design/lists/overview" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.cba56bc1.css">
<link rel="preload" href="/assets/js/runtime~main.f2f9534b.js" as="script">
<link rel="preload" href="/assets/js/main.01e4ab04.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Jetpack Compose 博物馆</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/">文档</a><a class="navbar__item navbar__link" href="/docs/open-source-project/compose-douban">开源项目</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/milklabdev/jetpack-compose-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">写在开头</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/category/入门">入门</a><button aria-label="Toggle the collapsible sidebar category &#x27;入门&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/installation">安装或更新 Android Studio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial">初识 Jetpack Compose</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/elements/alertdialog">基础组件</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/layout/box">布局组件</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" href="/docs/category/设计">设计</a><button aria-label="Toggle the collapsible sidebar category &#x27;设计&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/category/动画animation">动画（Animation）</a><button aria-label="Toggle the collapsible sidebar category &#x27;动画（Animation）&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/category/主题theming">主题（Theming）</a><button aria-label="Toggle the collapsible sidebar category &#x27;主题（Theming）&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/category/手势gesture">手势（Gesture）</a><button aria-label="Toggle the collapsible sidebar category &#x27;手势（Gesture）&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" tabindex="0" href="/docs/category/列表lists">列表（Lists）</a><button aria-label="Toggle the collapsible sidebar category &#x27;列表（Lists）&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/design/lists/overview">概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/lists/listItemClick">列表点击事件</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/category/图形graphics">图形（Graphics）</a><button aria-label="Toggle the collapsible sidebar category &#x27;图形（Graphics）&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/resources">资源</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/category/技术原理">技术原理</a><button aria-label="Toggle the collapsible sidebar category &#x27;技术原理&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>概述</h1></header><p>许多应用程序需要显示项目的集合。本文解释了你如何在 <code>Jetpack Compose</code> 中有效地做到这一点。</p><p>如果你知道你的用例不需要任何滚动，你可能希望使用一个简单的 <code>Column</code> 或 <code>Row</code>（取决于方向），并像这样通过迭代列表来显示每个项目的内容。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MessageList(messages: List&lt;Message&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Column {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        messages.forEach { message -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MessageRow(message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>我们可以通过使用 <code>verticalScroll()</code> 这个 <code>modifier</code> 来让 <code>Column</code> 变得可滚动。更多信息见<a href="/docs/design/gesture/overview">手势</a>文档。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="1-lazy-composables">1. Lazy composables<a class="hash-link" href="#1-lazy-composables" title="Direct link to heading">​</a></h2><p>如果你需要显示大量的项目（或一个未知长度的列表），使用像 <code>Column</code> 这样的布局会导致性能问题，因为所有的项目都会被组合和布局，无论它们是否可见。</p><p><code>Compose</code> 提供了一组组件，它们只对组件视口中可见的项目进行组合和布局。这些组件包括 <code>LazyColumn</code> 和 <code>LazyRow</code>。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>如果你使用过 <code>RecyclerView</code> 组件，这些组件遵循相同的原则</p></div></div><p>顾名思义，<code>LazyColumn</code> 和 <code>LazyRow</code> 的区别在于它们的项目布局和滚动方向。<code>LazyColumn</code> 产生一个垂直滚动的列表，而 <code>LazyRow</code> 产生一个水平滚动的列表。</p><p><code>Lazy</code> 组件与 <code>Compose</code> 中的大多数布局不同。<code>Lazy</code> 组件不接受 <strong>@Composable</strong> 内容块参数，允许应用程序直接撰写 <code>Composable</code>，而是提供一个 <code>LazyListScope.()</code> 块。这个 <code>LazyListScope</code> 块提供了一个 <code>DS</code>L，允许应用程序描述项目内容。然后，<code>Lazy</code> 组件负责根据布局和滚动位置的要求，添加每个项目的内容。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>关键术语</h5></div><div class="admonition-content"><p><strong><em>DSL</em></strong> 是指特定领域的语言。有关 <code>Compose</code> 如何为某些 <code>API</code> 定义 <code>DSL</code> 的更多信息，请参阅 <a href="https://developer.android.com/jetpack/compose/kotlin#dsl" target="_blank" rel="noopener noreferrer">Kotlin for Compose</a> 文档。</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="2-lazylistscope-dsl">2. LazyListScope DSL<a class="hash-link" href="#2-lazylistscope-dsl" title="Direct link to heading">​</a></h2><p><code>LazyListScope</code> 的 <code>DSL</code> 提供了许多函数来描述布局中的项目。最基本的 <code>item()</code> 可以添加一个单项，而 <code>item(Int)</code> 添加了多个项目。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">LazyColumn {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 添加单个项目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    item {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Text(text = &quot;First item&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 添加五个项目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    items(5) { index -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Text(text = &quot;Item: $index&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 添加其他单个项目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    item {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Text(text = &quot;Last item&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>还有一些扩展功能，允许你添加项目的集合，如 <code>List</code>。这些扩展函数使我们能够轻松地移植上面 <code>Column</code> 的例子。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">import androidx.compose.foundation.lazy.items</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MessageList(messages: List&lt;Message&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LazyColumn {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        items(messages) { message -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MessageRow(message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>items()</code> 的扩展函数还有一个变体，叫做 <code>itemsIndexed()</code>，它提供了索引。更多细节请参见 <a href="https://developer.android.com/reference/kotlin/androidx/compose/foundation/lazy/LazyListScope" target="_blank" rel="noopener noreferrer">LazyListScope</a>参考。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="3-内容填充">3. 内容填充<a class="hash-link" href="#3-内容填充" title="Direct link to heading">​</a></h2><p>在 <code>Lazy</code>组件中，我们如果要设置 <code>Lazy</code> 组件里面内容的内边距时，我们可以使用 <code>contentPadding</code> 参数来进行填充</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MessageList() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Box(Modifier.background(Color.Gray)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        LazyColumn(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            modifier = Modifier.border(5.dp, color = Color.Blue),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            contentPadding = PaddingValues(horizontal = 16.dp, vertical = 8.dp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            items(20){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Text(&quot;LazyColumn&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在这个例子中，我们在水平边缘（左和右）添加 <code>16.dp</code> 的 <code>padding</code>，然后在内容的顶部和底部添加 <code>8.dp</code>。</p><p>请注意，这个 <code>padding</code> 是应用在 <code>LazyColumn</code> 里面的内容上的，而不是应用在 <code>LazyColumn</code> 本身。在上面的例子中，第一个项目将在它的顶部添加 <code>8.dp</code> 的 <code>padding</code>，最后一个项目将在它的底部添加 <code>8.dp</code>，所有项目将在左边和右边有 <code>16.dp</code> 的 <code>padding</code>。</p><img src="/assets/images/demo-79ed318e5a758ce50741292761145045.png"><h2 class="anchor anchorWithStickyNavbar_mojV" id="4-内容间距">4. 内容间距<a class="hash-link" href="#4-内容间距" title="Direct link to heading">​</a></h2><p>要在项目之间添加间距，你可以使用 <code>Arrangement.spacedBy()</code>。下面的例子在每个项目之间增加了 <code>4.dp</code> 的空间。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MessageList() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Box(Modifier.background(Color.Gray)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        LazyColumn(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            modifier = Modifier.border(5.dp, color = Color.Blue),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            contentPadding = PaddingValues(horizontal = 16.dp, vertical = 8.dp),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            verticalArrangement = Arrangement.spacedBy(10.dp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            items(20){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Text(&quot;LazyColumn&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><img src="/assets/images/demo2-958829219eee7e790d4c4d2bca30ff02.png"><p>同样地，对于 <code>LazyRow</code> 也是如此。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="5-item-动画">5. Item 动画<a class="hash-link" href="#5-item-动画" title="Direct link to heading">​</a></h2><p>如果你使用过 <code>RecyclerView</code> 组件，你会知道它能自动对 <code>item</code> 变化进行动画处理。<code>Lazy</code> 布局还没有提供这个功能，这意味着 <code>item</code> 的变化会导致一个即时的 <code>snap</code>。你可以关注这个 <a href="https://issuetracker.google.com/issues/150812265?pli=1" target="_blank" rel="noopener noreferrer">bug</a> 来跟踪这个功能的任何变化。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="6-sticky-headers-实验性">6. Sticky headers (实验性)<a class="hash-link" href="#6-sticky-headers-实验性" title="Direct link to heading">​</a></h2><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>请注意</h5></div><div class="admonition-content"><p>实验性 <code>API</code> 在未来可能会发生变化，也可能被完全删除。</p></div></div><p>当显示分组数据的列表时，<code>sticky header</code> 模式很有帮助。下面你可以看到一个简单的例子，按指定的标题分组。</p><img src="/assets/images/demo-2bd04a91e12e539d33a238bf3b7d7583.gif"><p>为了用 <code>LazyColumn</code> 实现 <code>Sticky header</code>，你可以使用实验性的 <code>stickyHeader()</code> 函数，提供标题内容。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@ExperimentalFoundationApi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun ListWithHeader() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val sections = listOf(&quot;贡献者&quot;, &quot;眠眠的粉丝&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LazyColumn {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sections.forEachIndexed{ index, section -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stickyHeader {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Text(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    text = section,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    modifier = Modifier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .fillMaxWidth()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .background(Color(0xFFF2F4FB))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .padding(horizontal = 10.dp, vertical = 5.dp),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    fontWeight = FontWeight.W700,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    color = Color(0xFF0079D3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            when(index){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                0 -&gt; item{Contributors()}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                1 -&gt; item{TouchFish()}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>为了节省篇幅，完整实现代码可以以下方式查阅</p><ol><li><a href="/docs/code/design/overview/stickyHeader/">网站内</a></li><li><a href="https://github.com/compose-museum/compose-tutorial/blob/master/docs/code/design/overview/stickyHeader.kt" target="_blank" rel="noopener noreferrer">github</a></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="7-grids-实验性">7. Grids (实验性）<a class="hash-link" href="#7-grids-实验性" title="Direct link to heading">​</a></h2><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>请注意</h5></div><div class="admonition-content"><p>实验性 <code>API</code> 在未来可能会发生变化，也可能被完全删除。</p></div></div><p><code>LazyVerticalGrid</code> 可以实现类似于网格的效果</p><img src="/assets/images/demo3-38ddf3d421f84ea660b5e7608bc70917.png" width="300"><p><code>cells</code> 参数负责控制单元格如何形成列。下面的例子显示了网格中的项目，使用 <code>GridCells.Adaptive</code> 将每一列设置为至少 <code>128.dp</code>宽。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@ExperimentalFoundationApi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun PhotoGrid(photos: List&lt;Photo&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LazyVerticalGrid(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cells = GridCells.Adaptive(minSize = 128.dp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        items(photos) { photo -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PhotoItem(photo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果你知道要使用的列的确切数量，你可以转而提供一个包含所需列数量的 <a href="https://developer.android.com/reference/kotlin/androidx/compose/foundation/lazy/GridCells.Fixed" target="_blank" rel="noopener noreferrer">GridCells.Fixed</a> 实例。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="8-对滚动位置做出反应">8. 对滚动位置做出反应<a class="hash-link" href="#8-对滚动位置做出反应" title="Direct link to heading">​</a></h2><p>许多应用程序需要对滚动位置和 <code>item</code> 布局的变化做出反应和监听，<code>Lazy</code> 组件可以使用 <code>LazyListState</code> 来支持这种使用情况。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MessageList(messages: List&lt;Message&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 记住我们自己的 LazyListState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val listState = rememberLazyListState()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 把它提供给 LazyColumn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LazyColumn(state = listState) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>对于简单的使用情况，应用程序通常只需要知道第一个可见的 <code>item</code> 的信息。为此，<code>LazyListState</code> 提供了 <code>firstVisibleItemIndex</code> 和 <code>firstVisibleItemScrollOffset</code> 属性。</p><p>我们使用一个例子，即根据用户是否滚动过第一个项目来显示和隐藏一个按钮。</p><img src="/assets/images/demo2-cd55fb3f789c06e7f25c68fdd928fdcb.gif"><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@OptIn(ExperimentalAnimationApi::class) // AnimatedVisibility</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MessageList(messages: List&lt;Message&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Box {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val listState = rememberLazyListState()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val scope = rememberCoroutineScope()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        LazyColumn(state = listState) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 添加一个用于是否显示按钮的代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 如果第一个可见的项目已经被移动过去，就显示这个按钮。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val showButton by remember {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            derivedStateOf {         // 尽量减少不必要的合成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                listState.firstVisibleItemIndex &gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AnimatedVisibility(visible = showButton) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ScrollToTopButton()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 伪代码，可用 FAB 来实现</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ScrollToTopButton(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            onClick = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                scope.launch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    listState.animateScrollToItem(0) // 点击返回第一项</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 你可以在后面的章节中看到这个方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>上面的例子使用 <code>derivedStateOf()</code> 来减少不必要的合成。了解更多信息，请参见<a href="https://developer.android.com/jetpack/compose/side-effects#derivedstateof" target="_blank" rel="noopener noreferrer">副作用</a>文档。</p></div></div><p>当你需要更新其他 <code>UI</code> 的 <code>composables</code> 时，直接在 <code>composables</code> 中读取状态是很有用的，但也有一些场景不需要在同一个 <code>composables</code> 中处理事件。一个常见的例子是，一旦用户滚动过某个点，就发送一个分析事件。为了有效地处理这个问题，我们可以使用一个 <code>snapshotFlow()</code>。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">val listState = rememberLazyListState()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LazyColumn(state = listState) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LaunchedEffect(listState) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    snapshotFlow { listState.firstVisibleItemIndex }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .map { index -&gt; index &gt; 0 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .distinctUntilChanged()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .filter { it == true }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .collect {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MyAnalyticsService.sendScrolledPastFirstItemEvent()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>LazyListState</code> 还通过 <code>layoutInfo</code> 属性提供了关于当前正在显示的所有项目以及它们在屏幕上的界限的信息。更多信息请参见 <a href="https://developer.android.com/reference/kotlin/androidx/compose/foundation/lazy/LazyListLayoutInfo" target="_blank" rel="noopener noreferrer"><code>LazyListLayoutInfo</code></a> 类。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="9-控制滚动位置">9. 控制滚动位置<a class="hash-link" href="#9-控制滚动位置" title="Direct link to heading">​</a></h2><p>除了对滚动位置做出反应外，应用程序能够控制滚动位置也很有用。<code>LazyListState</code> 通过 <code>scrollToItem()</code> 函数和 <code>animateScrollToItem()</code> 函数支持这一点，前者 &quot;立即 &quot;锁定滚动位置，后者则使用动画进行滚动（也被称为平滑滚动）。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>注意</h5></div><div class="admonition-content"><p><code>scrollToItem()</code> 和 <code>animateScrollToItem()</code> 都是 <code>suspend</code> 函数，这意味着我们需要在一个协程中调用它们。关于如何在 <code>Compose</code> 中这样做的更多信息，请参阅<a href="https://developer.android.com/jetpack/compose/kotlin#coroutines" target="_blank" rel="noopener noreferrer">协程文档</a></p></div></div><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MessageList(messages: List&lt;Message&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val listState = rememberLazyListState()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 记住一个协程作用域，以便能够启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val coroutineScope = rememberCoroutineScope()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LazyColumn(state = listState) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ScrollToTopButton(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        onClick = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            coroutineScope.launch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 滚动到第一个项目的动画</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                listState.animateScrollToItem(index = 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="10-大型数据集paging">10. 大型数据集（paging）<a class="hash-link" href="#10-大型数据集paging" title="Direct link to heading">​</a></h2><p><code>Paging</code> 库可以让应用程序能够支持大型项目列表，在必要时加载和显示列表的一小块。<code>Paging3.0</code>及以后的版本通过 <code>androidx.paging:paging-compose</code> 库提供 <code>Compose</code> 支持。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>注意</h5></div><div class="admonition-content"><p><code>Compose</code> 只支持 <code>Paging 3.0</code> 及以后的版本。如果你正在使用早期版本的 <code>Paging</code> 库，你需要先<a href="https://developer.android.com/topic/libraries/architecture/paging/v3-migration" target="_blank" rel="noopener noreferrer">迁移</a>到 3.0。</p></div></div><p>为了显示分页内容的列表，我们可以使用 <code>collectAsLazyPagingItems()</code> 扩展函数，然后将返回的 <code>LazyPagingItems</code> 传给我们 <code>LazyColumn</code> 中的 <code>items()</code>。类似于视图中的分页支持，你可以在数据加载时通过检查项目是否为空来显示占位符。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">import androidx.paging.compose.collectAsLazyPagingItems</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import androidx.paging.compose.items</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MessageList(pager: Pager&lt;Int, Message&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val lazyPagingItems = pager.flow.collectAsLazyPagingItems()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LazyColumn {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        items(lazyPagingItems) { message -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (message != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                MessageRow(message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                MessagePlaceholder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>如果你使用 <code>RemoteMediator</code> 从网络服务中获取数据，请确保提供真实大小的占位项。如果你使用一个 <code>RemoteMediator</code>，它将被反复调用以获取新的数据，直到屏幕被内容填满。如果提供小的占位符（或者根本没有占位符），屏幕可能永远不会被填满，而你的应用程序将获取许多页的数据。</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="11-items-key">11. Items Key<a class="hash-link" href="#11-items-key" title="Direct link to heading">​</a></h2><p>默认情况下，每个 <code>item</code> 的状态都是根据该 <code>item</code> 在列表中的位置来确定的。然而，如果数据集发生变化，这可能会导致问题，因为改变位置的 <code>item</code> 会失去任何记忆中的状态。如果你想象一下 <code>LazyRow</code> 在<code>LazyColumn</code> 中的情景，如果该行改变了 <code>item</code> 的位置，用户就会失去他们在该行中的滚动位置。</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>如果你想了解更多 <code>Compose</code> 如何记住状态的，请参阅这篇<a href="https://developer.android.com/jetpack/compose/state" target="_blank" rel="noopener noreferrer">文档</a></p></div></div><p>为了解决这个问题，你可以为每个项目提供一个稳定而唯一的密钥，为密钥参数提供一个块。提供一个稳定的键可以使 <code>item</code> 状态在数据集变化时保持一致。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MessageList(messages: List&lt;Message&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LazyColumn {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        items(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            items = messages,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            key = { message -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 返回 item 的一个稳定的且唯一的键</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                message.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ) { message -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MessageRow(message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</h5></div><div class="admonition-content"><p>所提供的任何密钥必须能够被存储在一个 <a href="https://developer.android.com/reference/android/os/Bundle" target="_blank" rel="noopener noreferrer">Bundle</a> 中。关于哪些类型可以被存储，请看该类的信息。</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/milklabdev/jetpack-compose-book/tree/master/docs/design/lists/overview.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/category/列表lists"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">列表（Lists）</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/design/lists/listItemClick"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">列表点击事件</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-lazy-composables" class="table-of-contents__link toc-highlight">1. Lazy composables</a></li><li><a href="#2-lazylistscope-dsl" class="table-of-contents__link toc-highlight">2. LazyListScope DSL</a></li><li><a href="#3-内容填充" class="table-of-contents__link toc-highlight">3. 内容填充</a></li><li><a href="#4-内容间距" class="table-of-contents__link toc-highlight">4. 内容间距</a></li><li><a href="#5-item-动画" class="table-of-contents__link toc-highlight">5. Item 动画</a></li><li><a href="#6-sticky-headers-实验性" class="table-of-contents__link toc-highlight">6. Sticky headers (实验性)</a></li><li><a href="#7-grids-实验性" class="table-of-contents__link toc-highlight">7. Grids (实验性）</a></li><li><a href="#8-对滚动位置做出反应" class="table-of-contents__link toc-highlight">8. 对滚动位置做出反应</a></li><li><a href="#9-控制滚动位置" class="table-of-contents__link toc-highlight">9. 控制滚动位置</a></li><li><a href="#10-大型数据集paging" class="table-of-contents__link toc-highlight">10. 大型数据集（paging）</a></li><li><a href="#11-items-key" class="table-of-contents__link toc-highlight">11. Items Key</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/milklabdev" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Milk Lab, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f2f9534b.js"></script>
<script src="/assets/js/main.01e4ab04.js"></script>
</body>
</html>