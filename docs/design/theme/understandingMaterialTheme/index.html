<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">深入理解 MaterialTheme 与 CompositionLocal | 你好 Compose</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://milklab.dev/docs/design/theme/understandingMaterialTheme"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="深入理解 MaterialTheme 与 CompositionLocal | 你好 Compose"><meta data-react-helmet="true" name="description" content="1. MaterialTheme 是怎么做到的"><meta data-react-helmet="true" property="og:description" content="1. MaterialTheme 是怎么做到的"><link data-react-helmet="true" rel="icon" href="/img/logo.svg"><link data-react-helmet="true" rel="canonical" href="https://milklab.dev/docs/design/theme/understandingMaterialTheme"><link data-react-helmet="true" rel="alternate" href="https://milklab.dev/docs/design/theme/understandingMaterialTheme" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://milklab.dev/docs/design/theme/understandingMaterialTheme" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.cba56bc1.css">
<link rel="preload" href="/assets/js/runtime~main.f2f9534b.js" as="script">
<link rel="preload" href="/assets/js/main.01e4ab04.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Jetpack Compose 博物馆</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/">文档</a><a class="navbar__item navbar__link" href="/docs/open-source-project/compose-douban">开源项目</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/milklabdev/jetpack-compose-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">写在开头</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/category/入门">入门</a><button aria-label="Toggle the collapsible sidebar category &#x27;入门&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/installation">安装或更新 Android Studio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial">初识 Jetpack Compose</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/elements/alertdialog">基础组件</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/layout/box">布局组件</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" href="/docs/category/设计">设计</a><button aria-label="Toggle the collapsible sidebar category &#x27;设计&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/category/动画animation">动画（Animation）</a><button aria-label="Toggle the collapsible sidebar category &#x27;动画（Animation）&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" tabindex="0" href="/docs/category/主题theming">主题（Theming）</a><button aria-label="Toggle the collapsible sidebar category &#x27;主题（Theming）&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/theme/meetMaterialTheme">初识 MaterialTHeme</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/design/theme/understandingMaterialTheme">深入理解 MaterialTheme 与 CompositionLocal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/theme/customYourTheme">自定义你的主题方案</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/category/手势gesture">手势（Gesture）</a><button aria-label="Toggle the collapsible sidebar category &#x27;手势（Gesture）&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/category/列表lists">列表（Lists）</a><button aria-label="Toggle the collapsible sidebar category &#x27;列表（Lists）&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/category/图形graphics">图形（Graphics）</a><button aria-label="Toggle the collapsible sidebar category &#x27;图形（Graphics）&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/resources">资源</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/category/技术原理">技术原理</a><button aria-label="Toggle the collapsible sidebar category &#x27;技术原理&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>深入理解 MaterialTheme 与 CompositionLocal</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="1-materialtheme-是怎么做到的">1. MaterialTheme 是怎么做到的<a class="hash-link" href="#1-materialtheme-是怎么做到的" title="Direct link to heading">​</a></h2><p>为深入理解 MaterialTheme 工作原理，我们需要进入源码一探究竟。</p><img src="/assets/images/carbon-990aea6206587bde39fb4b2fe91fc11b.png" width="90%" height="50%"><p>需要注意的是，此时传入的 content 参数其实是声明在 Theme 中的自定义布局系统，其类型是一个带有 Composable 注解的 lambda (对于这类带有 Composable 的 lambda 简称为 composable )。</p><p>我们所关注的 colors 被 remember 修饰后赋值为 rememberedColors。如果 MaterialTheme 这个 composable 发生 recompose 时便会检查 colors 是否发生了改变从而决定更新。</p><p>接下来使用 CompositionLocalProvider 方法，通过中缀 providers 将 rememberedColors 提供给了 LocalColors。让我们回到自定义视图中，看看我们是如何通过 MaterialTheme 获取到当前主题配色的。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">object MaterialTheme {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val colors: Colors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @ReadOnlyComposable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        get() = LocalColors.current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val typography: Typography</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @ReadOnlyComposable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        get() = LocalTypography.current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val shapes: Shapes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @ReadOnlyComposable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        get() = LocalShapes.current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>可以发现在获取到当前主题配色时使用的是 MaterialTheme 类单例的 colors 属性，间接使用了 LocalColors。</p><p>总结来说，我们在自定义 Theme 使用的是 MaterialTheme 函数为 LocalColors 赋值，而在获取时使用的是 MaterialTheme 类单例，间接从 LocalColors 中获取到值。所以 LocalColors 到底是何方神圣呢？</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">internal val LocalColors = staticCompositionLocalOf { lightColors() }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>通过声明可以发现他实际上是一个 CompositionLocal，其初始值是 lightColors() 返回的 colors 配置。</p><p>MaterialTheme 方法中通过 CompositionLocalProvider 方法为我们的自定义视图 composable 提供了一些 CompositionLocal，包含了所有的主题配置信息。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="2-compositionlocal介绍">2. CompositionLocal介绍<a class="hash-link" href="#2-compositionlocal介绍" title="Direct link to heading">​</a></h2><p>很多时候我们需要在 composable 树中共享一些数据（例如主题配置），一种有效方式就是通过显式参数传递的方式进行实现，当参数越来越多时，composable 参数列表会变得越来越臃肿，难以进行维护。当 composable 需要彼此间传递数据，并且实现各自的私有性时，如果仍采用显式参数传递的方式则可能会产生意料之外的麻烦与崩溃。</p><p>为解决上述痛点问题， Jetpack Compose 提供了 CompostionLocal 用来完成 composable 树中共享数据方式。CompositionLocals 是具有层级的，可以被限定在以某个 composable 作为根结点的子树中，其默认会向下传递的，当然当前子树中的某个 composable 可以对该 CompositionLocals 进行覆盖，从而使得新值会在这个 composable 中继续向下传递。</p><p>Jetpack Compose 为我们提供了compositionLocalOf 方法用于创建一个 CompostionLocal 实例。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">import androidx.compose.runtime.compositionLocalOf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var LocalString = compositionLocalOf { &quot;Jetpack Compose&quot; }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在 composable 树的某个地方，我们可以使用 CompositionLocalProvider 方法为 CompositionLocal 提供一个值。通常情况下位于 composable 树的根部，但也可以位于任何位置，还可以在多个位置使用，以覆盖子树能够获取到的值。我们的示例选择在 Column 所包含的 composable 中使用 CompositionLocalProvider。</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">import androidx.compose.runtime.CompositionLocalProvider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setContent {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CustomColorTheme(true) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Column {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CompositionLocalProvider(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                LocalString provides &quot;Hello World&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Text(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    text = LocalString.current,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    color = Color.Green</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                CompositionLocalProvider(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    LocalString provides &quot;Ruger McCarthy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Text(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        text = LocalString.current,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        color = Color.Blue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Text(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                text = LocalString.current,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                color = Color.Red</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>实际效果可以看到，虽然所有 composable 均依赖的是同一个 CompositionLocal，而其获得到的实际的值却是不一样的。</p><img src="/assets/images/demo1-176bea2d5394258bab0083798e3a99e8.png"><h3 class="anchor anchorWithStickyNavbar_mojV" id="compositionlocalof-与-staticcompositionlocalof-区别">compositionLocalOf 与 staticCompositionLocalOf 区别<a class="hash-link" href="#compositionlocalof-与-staticcompositionlocalof-区别" title="Direct link to heading">​</a></h3><p>当我们创建  CompositionLocal 时，通常需要使用 <code>compositionLocalOf</code> 或 <code>staticCompositionLocalOf</code> 方法。然而这两者的区别是什么呢？其实<code>staticCompositionLocalOf</code> 方法声明处的注释文档中说明了一切。</p><blockquote><p>Unlike compositionLocalOf, reads of a staticCompositionLocalOf are not tracked by the composer and changing the value provided in the CompositionLocalProvider call will cause the entirety of the content to be recomposed instead of just the places where in the composition the local value is used.</p></blockquote><p>简单概括就是，当我们选择使用 <code>staticCompositionLocalOf</code> 时，实际上创建了个<code>StaticProvidableCompositionLocal</code> 实例，当其所提供的值改变时，会导致  CompositionLocalProvide 内部所有 composable 触发重组(recompose)。</p><p>如果我们选择使用 <code>compositionLocalOf</code>，实际上创建了个 <code>DynamicProvidableCompositionLocal</code> 实例，当其所提供的值改变时，仅会导致  CompositionLocalProvide 内部依赖当前 CompositionLocal 的 composable 触发重组(recompose)。</p><p>Talk is cheap，Show me the code~. 接下来我们进行对照示例印证。</p><p>既然要对照，我们就分别使用 <code>staticCompositionLocalOf</code> 与 <code>compositionLocalOf</code> 创建 CompositionLocal。我们使用三层嵌套的 Box 进行举例，我们将 CompositionLocalProvide 包裹在最外层，若某层 Box 触发了重组(recompose) 便会更新该层的文本信息。我们的示例中处于中层 的 Box 依赖了 CompositionLocal。</p><p>当我们修改了 CompositionLocal 所提供的值时，可以发现 <code>staticCompositionLocalOf</code> 场景下，所有 Box 均发生了重组，而 <code>DynamicCompositionLocal</code> 场景下，仅中层依赖了 CompositionLocal 的 Box 触发了重组。文章结尾处提供了实例代码。</p><img src="/assets/images/static-20f8852168138d4256115acbcf2dbf30.gif" width="40%" height="40%"><img src="/assets/images/dynamic-50447222a3ea39d95f098181c0c9006f.gif" width="40%" height="40%"><p><strong>示例代码</strong></p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var isStatic = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var compositionLocalName = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val currentLocalColor = if (isStatic) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compositionLocalName = &quot;StaticCompositionLocal 场景&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    staticCompositionLocalOf { Color.Black }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compositionLocalName = &quot;DynamicCompositionLocal 场景&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compositionLocalOf { Color.Black }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var recomposeFlag = &quot;Init&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Preview</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun CompositionLocalDemo(isStatic: Boolean = false) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var color by remember{ mutableStateOf(Color.Green) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Box(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modifier = Modifier.fillMaxSize(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        contentAlignment = Alignment.Center</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Column(horizontalAlignment = Alignment.CenterHorizontally){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Text(text = &quot;${compositionLocalName}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Spacer (Modifier.height(20.dp))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CompositionLocalProvider(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                currentLocalColor provides color</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                TaggedBox(&quot;Wrapper: ${recomposeFlag}&quot;, 400.dp,Color.Red) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    TaggedBox(&quot;Middle: ${recomposeFlag}&quot;, 300.dp, currentLocalColor.current) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        TaggedBox(&quot;Inner: ${recomposeFlag}&quot;, 200.dp, Color.Yellow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Spacer (Modifier.height(20.dp))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Button(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                onClick = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    color = Color.Blue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Text(text = &quot;Change Theme&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    recomposeFlag = &quot;Recompose&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun TaggedBox(tag:String, size: Dp, background: Color, content: @Composable () -&gt; Unit = {}) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Column(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modifier = Modifier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .size(size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .background(background),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        horizontalAlignment = Alignment.CenterHorizontally) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Text(text = tag)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Box(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            modifier = Modifier.fillMaxSize(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            contentAlignment = Alignment.Center</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            content()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/milklabdev/jetpack-compose-book/tree/master/docs/design/theme/understandingMaterialTheme.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/design/theme/meetMaterialTheme"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">初识 MaterialTHeme</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/design/theme/customYourTheme"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">自定义你的主题方案</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-materialtheme-是怎么做到的" class="table-of-contents__link toc-highlight">1. MaterialTheme 是怎么做到的</a></li><li><a href="#2-compositionlocal介绍" class="table-of-contents__link toc-highlight">2. CompositionLocal介绍</a><ul><li><a href="#compositionlocalof-与-staticcompositionlocalof-区别" class="table-of-contents__link toc-highlight">compositionLocalOf 与 staticCompositionLocalOf 区别</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/milklabdev" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Milk Lab, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f2f9534b.js"></script>
<script src="/assets/js/main.01e4ab04.js"></script>
</body>
</html>