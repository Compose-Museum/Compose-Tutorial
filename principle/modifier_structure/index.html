
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.compose.net.cn/principle/modifier_structure/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>图解Modifier - Jetpack Compose</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetbrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Jetbrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#modifier" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Jetpack Compose" class="md-header__button md-logo" aria-label="Jetpack Compose" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jetpack Compose
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              图解Modifier
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Compose-Museum/Compose-Tutorial/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Jetpack Compose 博物馆
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link md-tabs__link--active">
        Jetpack Compose
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../third-party-component/accompanist/overview/" class="md-tabs__link">
        第三方组件
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../api/elements/text/" class="md-tabs__link">
        API 文档
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../open-source-project/compose-douban/" class="md-tabs__link">
        开源项目
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Jetpack Compose" class="md-nav__button md-logo" aria-label="Jetpack Compose" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Jetpack Compose
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Compose-Museum/Compose-Tutorial/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Jetpack Compose 博物馆
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Jetpack Compose
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Jetpack Compose" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Jetpack Compose
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../start/" class="md-nav__link">
        在开始之前
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/" class="md-nav__link">
        快速入门
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4">
          基本组件
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="基本组件" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          基本组件
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elements/alertdialog/" class="md-nav__link">
        AlertDialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elements/button/" class="md-nav__link">
        Button
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elements/card/" class="md-nav__link">
        Card
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elements/floatingactionbutton/" class="md-nav__link">
        FloatingActionButton
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elements/icon/" class="md-nav__link">
        Icon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elements/image/" class="md-nav__link">
        Image
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elements/iconbutton/" class="md-nav__link">
        IconButton
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elements/surface/" class="md-nav__link">
        Surface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elements/slider/" class="md-nav__link">
        Slider
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elements/text/" class="md-nav__link">
        Text
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elements/textfield/" class="md-nav__link">
        TextField
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_5" type="checkbox" id="__nav_1_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_5">
          布局组件
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="布局组件" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_5">
          <span class="md-nav__icon md-icon"></span>
          布局组件
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../layout/bottomnavigation/" class="md-nav__link">
        BottomNavigation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../layout/column/" class="md-nav__link">
        Column
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../layout/modalbottomsheetlayout/" class="md-nav__link">
        ModalBottomSheetLayout
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../layout/row/" class="md-nav__link">
        Row
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../layout/spacer/" class="md-nav__link">
        Spacer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../layout/scaffold/" class="md-nav__link">
        Scaffold
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../layout/topappbar/" class="md-nav__link">
        TopAppBar
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../layout/custom_layout/" class="md-nav__link">
        自定义布局
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../layout/intrinsic/" class="md-nav__link">
        固有特性测量
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../layout/subcomposelayout/" class="md-nav__link">
        SubcomposeLayout
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_6" type="checkbox" id="__nav_1_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_6">
          设计
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="设计" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_6">
          <span class="md-nav__icon md-icon"></span>
          设计
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_6_1" type="checkbox" id="__nav_1_6_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_6_1">
          动画 (Animation)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="动画 (Animation)" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_6_1">
          <span class="md-nav__icon md-icon"></span>
          动画 (Animation)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/animation/overview/" class="md-nav__link">
        概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/animation/animationvisibility/" class="md-nav__link">
        AnimationVisibility
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/animation/animatestate/" class="md-nav__link">
        Animate*State
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/animation/animatable/" class="md-nav__link">
        Animatable
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/animation/update_transition/" class="md-nav__link">
        UpdateTransition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_6_2" type="checkbox" id="__nav_1_6_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_6_2">
          主题 (Theming)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="主题 (Theming)" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_6_2">
          <span class="md-nav__icon md-icon"></span>
          主题 (Theming)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/theme/overview/" class="md-nav__link">
        概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/theme/meet_material_theme/" class="md-nav__link">
        初识 MaterialTheme
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/theme/understanding_material_theme/" class="md-nav__link">
        深入理解 MaterialTheme 与 CompositionLocal
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/theme/custom_your_theme/" class="md-nav__link">
        自定义你的主题方案
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_6_3" type="checkbox" id="__nav_1_6_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_6_3">
          手势 (Gestures)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="手势 (Gestures)" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_6_3">
          <span class="md-nav__icon md-icon"></span>
          手势 (Gestures)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/gesture/overview/" class="md-nav__link">
        概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/gesture/draggable/" class="md-nav__link">
        Draggable拖动
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/gesture/swipeable/" class="md-nav__link">
        Swipeable滑动
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/gesture/transformer/" class="md-nav__link">
        Transformer双指拖动、缩放与旋转
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/gesture/nested_scroll/" class="md-nav__link">
        NestedScroll嵌套滑动
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/gesture/custom_gesture/" class="md-nav__link">
        自定义触摸反馈
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_6_4" type="checkbox" id="__nav_1_6_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_6_4">
          列表 (Lists)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="列表 (Lists)" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_6_4">
          <span class="md-nav__icon md-icon"></span>
          列表 (Lists)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/lists/overview/" class="md-nav__link">
        概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/lists/list_item_click/" class="md-nav__link">
        列表点击事件
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/draw/custom_draw/" class="md-nav__link">
        绘制 (Graphics)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7" type="checkbox" id="__nav_1_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7">
          关于 Modifier
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="关于 Modifier" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_7">
          <span class="md-nav__icon md-icon"></span>
          关于 Modifier
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modifier/overview/" class="md-nav__link">
        概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modifier/introduction/" class="md-nav__link">
        方法介绍
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_8" type="checkbox" id="__nav_1_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1_8">
          技术原理
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="技术原理" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_8">
          <span class="md-nav__icon md-icon"></span>
          技术原理
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../recomposition_scope/" class="md-nav__link">
        了解Compose的重组作用域
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../snapshot/" class="md-nav__link">
        透过Snapshot看重组
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gap_buffer/" class="md-nav__link">
        Compose运行原理与GapBuffer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../recompose_working_principle/" class="md-nav__link">
        重组的工作流程
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          图解Modifier
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        图解Modifier
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modifier" class="md-nav__link">
    Modifier 接口
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifier_1" class="md-nav__link">
    Modifier 链的构建过程
  </a>
  
    <nav class="md-nav" aria-label="Modifier 链的构建过程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#then" class="md-nav__link">
    then()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#composed" class="md-nav__link">
    composed()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifier_2" class="md-nav__link">
    Modifier 链的遍历
  </a>
  
    <nav class="md-nav" aria-label="Modifier 链的遍历">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#foldin-foldout" class="md-nav__link">
    foldIn() 与 foldOut() 用法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foldin-foldout_1" class="md-nav__link">
    foldIn() 与 foldOut() 实现原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foldin-foldout_2" class="md-nav__link">
    foldIn() 与 foldOut() 的应用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    总结
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_9" type="checkbox" id="__nav_1_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_9">
          架构
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="架构" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_9">
          <span class="md-nav__icon md-icon"></span>
          架构
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/architecture_for_compose/" class="md-nav__link">
        Compose架构如何选？MVP,MVVM,MVI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/use_jetpack_in_compose/" class="md-nav__link">
        在 Compose 中使用 Jetpack 组件库
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../codelabs/" class="md-nav__link">
        代码实验室
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/" class="md-nav__link">
        资源
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../version/" class="md-nav__link">
        版本更新迭代内容与介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        关于贡献
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          第三方组件
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第三方组件" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          第三方组件
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Accompanist
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Accompanist" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Accompanist
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/accompanist/overview/" class="md-nav__link">
        概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/accompanist/coil/" class="md-nav__link">
        Coil
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/accompanist/glide/" class="md-nav__link">
        Glide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/accompanist/insets/" class="md-nav__link">
        Insets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/accompanist/system_ui_controller/" class="md-nav__link">
        System UI Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/accompanist/appcompat_theme/" class="md-nav__link">
        AppCompat Theme
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/accompanist/pager_layouts/" class="md-nav__link">
        Pager layouts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/accompanist/swipe_refresh/" class="md-nav__link">
        Swipe Refresh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/accompanist/flow_layouts/" class="md-nav__link">
        Flow layouts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/shimmer/compose_shimmer/" class="md-nav__link">
        Compose版骨架屏
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/coil/" class="md-nav__link">
        Coil
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/statelayout/compose_statelayout/" class="md-nav__link">
        Compose版StateLayout
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../third-party-component/refreshlayout/compose_refreshlayout/" class="md-nav__link">
        Compose版SmartRefreshLayout
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          API 文档
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API 文档" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API 文档
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          组件
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="组件" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          组件
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/elements/text/" class="md-nav__link">
        Text
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/elements/button/" class="md-nav__link">
        Button
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          开源项目
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="开源项目" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          开源项目
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../open-source-project/compose-douban/" class="md-nav__link">
        Compose 仿豆瓣榜单客户端
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../open-source-project/compose-moon-animation/" class="md-nav__link">
        Compose 实现月亮阴晴圆缺动画
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../open-source-project/compose-gmusic/" class="md-nav__link">
        Compose 一款简易的音乐播放软件
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../open-source-project/compose-scrollable-appbar/" class="md-nav__link">
        Compose 伸缩 ToolBar 的实现
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../open-source-project/compose-wan-android/" class="md-nav__link">
        Compose + MVI + Navigation 快速实现 wanAndroid 客户端
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../open-source-project/compose-spring-handwriting/" class="md-nav__link">
        Compose 实现手写春联效果
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modifier" class="md-nav__link">
    Modifier 接口
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifier_1" class="md-nav__link">
    Modifier 链的构建过程
  </a>
  
    <nav class="md-nav" aria-label="Modifier 链的构建过程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#then" class="md-nav__link">
    then()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#composed" class="md-nav__link">
    composed()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifier_2" class="md-nav__link">
    Modifier 链的遍历
  </a>
  
    <nav class="md-nav" aria-label="Modifier 链的遍历">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#foldin-foldout" class="md-nav__link">
    foldIn() 与 foldOut() 用法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foldin-foldout_1" class="md-nav__link">
    foldIn() 与 foldOut() 实现原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foldin-foldout_2" class="md-nav__link">
    foldIn() 与 foldOut() 的应用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    总结
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/Compose-Museum/Compose-Tutorial/tree/main/docs/principle/modifier_structure.md" title="编辑此页" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



  <h1>图解Modifier</h1>

<p>想必许多小伙伴在使用 Jetpack Compose 开发时都使用过 Modifier 来修饰 UI 组件，做过一段时间 Compose 开发的小伙伴都会发现 UI 组件最终所呈现效果与 Modifier 调用顺序是息息相关的。这是因为 Modifier 会由于调用顺序的不同而产生不同的 Modifier 链，Jetpack Compose 会按照 Modifier 链上的顺序进行执行，从而导致 Modifier 调用顺序不同时，UI 组件最终呈现的效果也会不同。那么 Modifier 链在底层如何存储的呢？本文将带着大家来一起扒一扒 Modifier 实现原理，结合图片来解释 Modifier 链的底层数据结构。</p>
<div align = "center">
  <img src = "../../../assets/principle/modifier_structure/demo1.png" width = "50%" height = "50%">
</div>

<h2 id="modifier">Modifier 接口</h2>
<div align = "center">
  <img src = "../../../assets/principle/modifier_structure/demo2.png" width = "50%" height = "50%">
</div>

<p>从源码中，我们可以发现 Modifier 实际上是个接口。</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span> <span class="nc">Modifier</span> <span class="p">{</span> 
        <span class="kd">fun</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">foldIn</span><span class="p">(</span><span class="n">initial</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">):</span> <span class="n">R</span>
    <span class="kd">fun</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">foldOut</span><span class="p">(</span><span class="n">initial</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="p">(</span><span class="n">Element</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">):</span> <span class="n">R</span>
    <span class="kd">fun</span> <span class="nf">any</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="p">(</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Boolean</span><span class="p">):</span> <span class="kt">Boolean</span>
    <span class="kd">fun</span> <span class="nf">all</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="p">(</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Boolean</span><span class="p">):</span> <span class="kt">Boolean</span>
    <span class="kd">infix</span> <span class="kd">fun</span> <span class="nf">then</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">Modifier</span><span class="p">):</span> <span class="n">Modifier</span> <span class="o">=</span> <span class="p">...</span>
    <span class="kd">interface</span> <span class="nc">Element</span> <span class="p">:</span> <span class="n">Modifier</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
    <span class="kd">companion</span> <span class="kd">object</span> <span class="err">: </span><span class="nc">Modifier</span> <span class="p">{</span>
        <span class="p">...</span> 
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>既然是接口肯定有其对应的实现。Modifier 接口有三个直接实现类或接口：伴生对象 Modifier、内部子接口Modifier.Element、CombinedModifier。</p>
<p><strong>伴生对象 Modifier：</strong>最常用的 Modifier， 当我们在代码中使用 Modifier.xxx()，实际使用的就是这个伴生对象。</p>
<p><strong>内部子接口 Modifier.Element：</strong>当我们使用Modifier.xxx()时，其内部实际会创建一个 Modifier 实例。我们以 size 为例。当我们使用 <code>Modifier.size(100.dp)</code> 时，实际上内部会创建一个 <code>SizeModifier</code> 实例</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span> <span class="n">Modifier</span><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="n">Dp</span><span class="p">)</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">then</span><span class="p">(</span>
    <span class="n">SizeModifier</span><span class="p">(</span>
        <span class="p">...</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<p>从源码中，我们可以发现 SizeModifier 实现了LayoutModifier 接口，而 LayoutModifier 接口又是 Modifier.Element 的子接口。</p>
<div align = "center">
  <img src = "../../../assets/principle/modifier_structure/demo3.png" width = "50%" height = "50%">
</div>

<p>可以说，当我们使用 Modifier.xxx() 所创建的各类 Modifier 追踪溯源，最后发现其实都是 Modifier.Element 子类。当我们使用 <code>Modifier.size()</code> 所创建的 SizeModifier 实际上是 Modifier 接口的直接子接口 <code>LayoutModifier</code> 的子类，像这类直接子接口或子类还有哪些呢，在这里我整理了一下。如图所示，这些接口基本涵盖了 Modifier 所提供的所有能力。</p>
<div align = "center">
  <img src = "../../../assets/principle/modifier_structure/demo4.png" width = "50%" height = "50%">
</div>

<p><strong>CombinedModifier：</strong> Compose内部维护的数据结构，用于连接 Modifier 链中的每个 Modifier 结点，后续会讲到。</p>
<h2 id="modifier_1">Modifier 链的构建过程</h2>
<p>接下来，我们通过实例来分析 Modifier 链是如何一步步创建的。</p>
<h3 id="then">then()</h3>
<p>一般我们会在代码中通过伴生对象 Modifier 来创建 Modifier 链。前文提到过，当我们使用 <code>Modifier.size()</code> 时会创建一个 SizeModifier 实例。我们进入 <code>size()</code> 实现会发现 SizeModifier实例被当作参数传入 <code>then()</code>方法中。而这个 <code>then()</code> 方法就是 Modifier 间相互连接的关键方法。</p>
<div class="highlight"><pre><span></span><code><span class="n">Modifier</span>
    <span class="p">.</span><span class="na">size</span><span class="p">(</span><span class="m">100.</span><span class="n">dp</span><span class="p">)</span>

<span class="kd">fun</span> <span class="n">Modifier</span><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="n">Dp</span><span class="p">)</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">then</span><span class="p">(</span> <span class="c1">// 关键方法</span>
    <span class="n">SizeModifier</span><span class="p">(</span>
        <span class="p">...</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<p>此时 <code>this</code> 指针仍指向的是我们的伴生对象 Modifier，所以我们看看伴生对象 Modifier 是如何实现 <code>then()</code> 方法的。 可以看到伴生对象 Modifier 的 <code>then()</code>方法实现的十分干脆，直接返回待连接的 SizeModifier。</p>
<div class="highlight"><pre><span></span><code><span class="kd">companion</span> <span class="kd">object</span> <span class="err">: </span><span class="nc">Modifier</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="kd">override</span> <span class="kd">infix</span> <span class="kd">fun</span> <span class="nf">then</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">Modifier</span><span class="p">):</span> <span class="n">Modifier</span> <span class="o">=</span> <span class="n">other</span>
<span class="p">}</span>
</code></pre></div>
<p>此时Modifier链的数据结构如下</p>
<div align = "center">
  <img src = "../../../assets/principle/modifier_structure/demo5.png" width = "50%" height = "50%">
</div>

<p>接下来，我们继续调用 <code>Modifier.background(Color.Red)</code>。由于是链式调用，此时当前 Modifier 是 SizeModifier，也就是说我们调用 background 时，其内部使用的 <code>this</code> 指针指向的是 SizeModifier 实例。</p>
<p>从源码我们可以看出，Background 实际上 <code>DrawModifier</code> 的实现类，同时也是 <code>Modifier.Element</code> 接口的实现类</p>
<div class="highlight"><pre><span></span><code><span class="n">Modifier</span>
    <span class="p">.</span><span class="na">size</span><span class="p">(</span><span class="m">100.</span><span class="n">dp</span><span class="p">)</span>
        <span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">Red</span><span class="p">)</span>

<span class="kd">fun</span> <span class="n">Modifier</span><span class="p">.</span><span class="nf">background</span><span class="p">(</span>
    <span class="n">color</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span>
    <span class="n">shape</span><span class="p">:</span> <span class="n">Shape</span> <span class="o">=</span> <span class="n">RectangleShape</span>
<span class="p">)</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">then</span><span class="p">(</span> <span class="c1">// 当前 this 指向 SizeModifier 实例</span>
    <span class="n">Background</span><span class="p">(</span>
        <span class="p">...</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<p>我们向上查找 SizeModifier 的 <code>then</code> 方法实现，最终在 <code>Modifier</code> 接口中找到了。此时，我们原有 SizeModifier 会通过一个 CombinedModifier 连接 Background</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span> <span class="nc">Modifier</span> <span class="p">{</span>
    <span class="kd">infix</span> <span class="kd">fun</span> <span class="nf">then</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">Modifier</span><span class="p">):</span> <span class="n">Modifier</span> <span class="o">=</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">other</span> <span class="o">===</span> <span class="n">Modifier</span><span class="p">)</span> <span class="k">this</span> <span class="k">else</span> <span class="n">CombinedModifier</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">CombinedModifier</span><span class="p">(</span>
    <span class="kd">private</span> <span class="kd">val</span> <span class="nv">outer</span><span class="p">:</span> <span class="n">Modifier</span><span class="p">,</span>
    <span class="kd">private</span> <span class="kd">val</span> <span class="nv">inner</span><span class="p">:</span> <span class="n">Modifier</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">Modifier</span>
</code></pre></div>
<p>此时 Modifier 链的数据结构如下</p>
<div align = "center">
  <img src = "../../../assets/principle/modifier_structure/demo6.png" width = "50%" height = "50%">
</div>

<p>我们通过图片可以直观查看 CombinedModifier 通过 outer 与 inner 连接了两个 Modifier。<strong>然而值得注意的是 outer 与 inner 字段都被使用 private 关键字声明，意味着不希望被外部拿到。</strong> Modifier 链既然以链式结构存储，官方又使用了 private 关键字声明，难道不允许我们遍历 Modifier 链嘛。其实官方早就替我们想好了，通过 <strong>foldOut()</strong> 与 <strong>foldIn()</strong>，有关于这部分内容我们马上就会讲到。</p>
<p>我们继续调用 <code>Modifier.padding(10.dp)</code>，此时 padding 内部使用的 <code>this</code> 指针指向的是 CombinedModifier 实例，我们翻阅 CombinedModifier 的 <code>then</code> 方法实现发生没有重写，最终还是回到了 <code>Modifier</code> 接口中。</p>
<p>此时待连接的实际上是一个 PaddingModifier 实例。</p>
<div class="highlight"><pre><span></span><code><span class="n">Modifier</span>
    <span class="p">.</span><span class="na">size</span><span class="p">(</span><span class="m">100.</span><span class="n">dp</span><span class="p">)</span>
    <span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">Red</span><span class="p">)</span>
    <span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">10.</span><span class="n">dp</span><span class="p">)</span>

<span class="kd">fun</span> <span class="n">Modifier</span><span class="p">.</span><span class="nf">padding</span><span class="p">(</span><span class="n">all</span><span class="p">:</span> <span class="n">Dp</span><span class="p">)</span> <span class="o">=</span>
    <span class="k">this</span><span class="p">.</span><span class="na">then</span><span class="p">(</span>
        <span class="n">PaddingModifier</span><span class="p">(</span>
            <span class="p">...</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
<p>此时Modifier链的数据结构如下</p>
<div align = "center">
  <img src = "../../../assets/principle/modifier_structure/demo7.png" width = "50%" height = "50%">
</div>

<h3 id="composed">composed()</h3>
<p>接下来我们想要添加一些手势监听，我们通常会使用 <code>Modifier.pointerInput()</code> 来定制手势处理。从源码中我们可以发现此时并没有使用 <code>then()</code> 方法连接 Modifier，而使用的是 <code>composed()</code> 方法。从 <code>composed()</code> 实现中我们可以看到最终仍然使用的是 <code>then()</code> 方法，此时待连接的是个 <code>ComposedModifier</code> 实例。然而我们知道其实我们真正要连接的实际上应该是手势处理相关Modifier，通过  <code>composed()</code> 方法参数我们可以得知，此时实际上 <code>ComposedModifier</code>内部持有了一个工厂 lambda 用于生产 Modifier 的，而真正要被连接的 Modifier 实际上就是工厂 lambda 的返回值 SuspendingPointerInputFilter。SuspendingPointerInputFilter 实际上是 PointerInputModifier 的实现类。而 ComposedModifier 实际上就是做了一个装箱过程。然而什么时候拆箱呢？这个我们后续会讲到的。</p>
<div class="highlight"><pre><span></span><code><span class="n">Modifier</span>
    <span class="p">.</span><span class="na">size</span><span class="p">(</span><span class="m">100.</span><span class="n">dp</span><span class="p">)</span>
    <span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">Red</span><span class="p">)</span>
    <span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">10.</span><span class="n">dp</span><span class="p">)</span>
        <span class="p">.</span><span class="na">pointerInput</span><span class="p">(</span><span class="kt">Unit</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>

<span class="kd">fun</span> <span class="n">Modifier</span><span class="p">.</span><span class="nf">pointerInput</span><span class="p">(</span>
    <span class="n">key1</span><span class="p">:</span> <span class="kt">Any?</span><span class="p">,</span>
    <span class="n">block</span><span class="p">:</span> <span class="n">suspend</span> <span class="n">PointerInputScope</span><span class="p">.()</span> <span class="o">-&gt;</span> <span class="kt">Unit</span>
<span class="p">):</span> <span class="n">Modifier</span> <span class="o">=</span> <span class="n">composed</span><span class="p">(</span> <span class="c1">//</span>
    <span class="p">...</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="c1">// SuspendingPointerInputFilter 是手势处理的真正Modifier</span>
    <span class="n">remember</span><span class="p">(</span><span class="n">density</span><span class="p">)</span> <span class="p">{</span> <span class="n">SuspendingPointerInputFilter</span><span class="p">(</span><span class="n">viewConfiguration</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span> <span class="p">}.</span><span class="na">apply</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">fun</span> <span class="n">Modifier</span><span class="p">.</span><span class="nf">composed</span><span class="p">(</span>
    <span class="n">inspectorInfo</span><span class="p">:</span> <span class="n">InspectorInfo</span><span class="p">.()</span> <span class="o">-&gt;</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">NoInspectorInfo</span><span class="p">,</span>
    <span class="n">factory</span><span class="p">:</span> <span class="nd">@Composable</span> <span class="n">Modifier</span><span class="p">.()</span> <span class="o">-&gt;</span> <span class="n">Modifier</span>
<span class="p">):</span> <span class="n">Modifier</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">then</span><span class="p">(</span><span class="n">ComposedModifier</span><span class="p">(</span><span class="n">inspectorInfo</span><span class="p">,</span> <span class="n">factory</span><span class="p">))</span>
</code></pre></div>
<p>此时 Modifier 链的数据结构如下</p>
<div align = "center">
  <img src = "../../../assets/principle/modifier_structure/demo8.png" width = "50%" height = "50%">
</div>

<p>以此类推，调用方法越多Modifier 链就会变得越长。</p>
<div align = "center">
  <img src = "../../../assets/principle/modifier_structure/demo9.png" width = "50%" height = "50%">
</div>

<h2 id="modifier_2">Modifier 链的遍历</h2>
<h3 id="foldin-foldout">foldIn() 与 foldOut() 用法</h3>
<p>Modifier 链既然是链式结构，说明是可以遍历的。然而前文我们也提到过， outer 与 inner 字段都被使用 private 关键字声明，意味着外部是拿不到的。所以，官方为我们提供了 <strong>foldOut()</strong> 与 <strong>foldIn()</strong> 专门用来遍历 Modifier 链。</p>
<div class="highlight"><pre><span></span><code><span class="n">Modifier</span>
    <span class="p">.</span><span class="na">size</span><span class="p">(</span><span class="m">100.</span><span class="n">dp</span><span class="p">)</span>
    <span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">Red</span><span class="p">)</span>
    <span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">10.</span><span class="n">dp</span><span class="p">)</span>
        <span class="p">.</span><span class="na">pointerInput</span><span class="p">(</span><span class="kt">Unit</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
</code></pre></div>
<p><strong>foldIn()：</strong> 正向遍历 Modifier 链，SizeModifier-&gt; Background -&gt; PaddingModifier -&gt; ComposedModifier</p>
<p><strong>foldOut()：</strong> 反向遍历 Modifier 链, ComposedModifier -&gt; PaddingModifier -&gt; Background -&gt;SizeModifier</p>
<p>当然 <strong>foldOut()</strong> 与 <strong>foldIn()</strong>  是需要传递参数的。这里涉及到两个参数 initial, operation。</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">foldIn</span><span class="p">(</span><span class="n">initial</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">):</span> <span class="n">R</span>
<span class="kd">fun</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">foldOut</span><span class="p">(</span><span class="n">initial</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="p">(</span><span class="n">Element</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">):</span> <span class="n">R</span>
</code></pre></div>
<p>initial：初始值</p>
<p>operation：每遍历到一个 Modifier 时的回调，这个 lambda 又有两个参数，R类型与 Element类型</p>
<p>为解释这两个参数的意义，我觉得用 for 循环类比比较恰当。</p>
<p>foldIn 方法类似于 <code>for (int i = initial;  ; operation())</code> 。 设置 initial 参数类似为 i 设置初始值，而 operation 返回值将作为值的更新。</p>
<p>foldOut 方法与之类似，只不过遍历顺序相反。</p>
<p>也就是说遍历当前 Modifier 时执行的operation 的返回值将作为链中下一个 Modifier 的 operation 的 R 类型参数传入。这么说可能比较晦涩难懂，在这里简单举个例子，比如说我们希望统计 Modifier 链中有 Modifier 的数量。</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span> <span class="nv">modifier</span> <span class="o">=</span> <span class="n">Modifier</span>
    <span class="p">.</span><span class="na">size</span><span class="p">(</span><span class="m">100.</span><span class="n">dp</span><span class="p">)</span>
    <span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">Red</span><span class="p">)</span>
    <span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">10.</span><span class="n">dp</span><span class="p">)</span>
    <span class="p">.</span><span class="na">pointerInput</span><span class="p">(</span><span class="kt">Unit</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="kd">val</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">modifier</span><span class="p">.</span><span class="na">foldIn</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="m">0</span><span class="p">)</span> <span class="p">{</span> <span class="n">currentIndex</span><span class="p">,</span> <span class="n">element</span> <span class="o">-&gt;</span>
    <span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="s">&quot;compose_study&quot;</span><span class="p">,</span> <span class="s">&quot;index: </span><span class="si">$</span><span class="n">currentIndex</span><span class="s"> , element :</span><span class="si">$</span><span class="n">element</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">currentIndex</span> <span class="o">+</span> <span class="m">1</span>
<span class="p">}</span>
</code></pre></div>
<p>foldOut 方法的方法也是类似，大家都简单理解为反向遍历 Modifier 链即可。</p>
<p>到这里大家可能心生疑问，我们前面所讲的 Modifier 链中不仅仅只有 Modifier.Element，其中还夹杂着许多 CombinedModifier。为什么我们遍历 Modifier 链时这些 CombinedModifier 没有出现呢？原因在于CombinedModifier 实际上是 Compose 内部维护的数据结构，官方如此设计是希望对上层开发者无感知。这两个方法的使用就说这么多，如果你对其内部实现原理感兴趣就请继续阅读下去～</p>
<h3 id="foldin-foldout_1">foldIn() 与 foldOut() 实现原理</h3>
<p>为探索原理，老规矩我们就需要进入源码一探究竟了。我们上来要做的就是找到 <strong>foldIn()</strong> 方法的实现。通过前面的例子我们可以得知，当 Modifier 链的长度大于等于 2 时，返回的 Modifier 实际上是一个 CombinedModifier 实例。那么我们就看看 ConbinedModifier 里面是怎么重写的 <strong>foldIn()</strong> 方法。</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">CombinedModifier</span><span class="p">(</span>
    <span class="kd">private</span> <span class="kd">val</span> <span class="nv">outer</span><span class="p">:</span> <span class="n">Modifier</span><span class="p">,</span>
    <span class="kd">private</span> <span class="kd">val</span> <span class="nv">inner</span><span class="p">:</span> <span class="n">Modifier</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">Modifier</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="kd">override</span> <span class="kd">fun</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">foldIn</span><span class="p">(</span><span class="n">initial</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Modifier</span><span class="p">.</span><span class="na">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">):</span> <span class="n">R</span> <span class="o">=</span>
        <span class="n">inner</span><span class="p">.</span><span class="na">foldIn</span><span class="p">(</span><span class="n">outer</span><span class="p">.</span><span class="na">foldIn</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">operation</span><span class="p">),</span> <span class="n">operation</span><span class="p">)</span> 
<span class="p">}</span>
</code></pre></div>
<p>可以看到第一个参数传入的是 outer.foldIn(initial. operation) 的返回值，经过一路递归向上即可到达最顶部的outer Modifier。值得注意的是，我们设置的初始值也跟随outer一路透传上去了。</p>
<div align = "center">
  <img src = "../../../assets/principle/modifier_structure/demo10.png" width = "50%" height = "50%">
</div>

<p>根据 Modifier 链的数据结构，我们很容易发现最顶部的outer Modifier一定是个 Modifier.Element，此时我们就要看看 Modifier.Element 是怎么重写的 <strong>foldIn()</strong> 方法了。通过源码我们看到直接调用了我们传入的lambda，并将 lambda 返回值作为 <strong>foldIn()</strong> 方法的返回值返回。</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span> <span class="nc">Element</span> <span class="p">:</span> <span class="n">Modifier</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="kd">override</span> <span class="kd">fun</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">foldIn</span><span class="p">(</span><span class="n">initial</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">):</span> <span class="n">R</span> <span class="o">=</span>
        <span class="n">operation</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>接下来，我们就退到了上一层 CombinedModifier，接下里我们再看看他是怎么做的。紧接着调用了 inner.foldIn()</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">CombinedModifier</span><span class="p">(</span>
    <span class="kd">private</span> <span class="kd">val</span> <span class="nv">outer</span><span class="p">:</span> <span class="n">Modifier</span><span class="p">,</span>
    <span class="kd">private</span> <span class="kd">val</span> <span class="nv">inner</span><span class="p">:</span> <span class="n">Modifier</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">Modifier</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="kd">override</span> <span class="kd">fun</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">foldIn</span><span class="p">(</span><span class="n">initial</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Modifier</span><span class="p">.</span><span class="na">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">):</span> <span class="n">R</span> <span class="o">=</span>
        <span class="n">inner</span><span class="p">.</span><span class="na">foldIn</span><span class="p">(</span><span class="n">outer</span><span class="p">.</span><span class="na">foldIn</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">operation</span><span class="p">),</span> <span class="n">operation</span><span class="p">)</span> 
<span class="p">}</span>
</code></pre></div>
<p>我们不妨看看当前场景下的图示。</p>
<div align = "center">
  <img src = "../../../assets/principle/modifier_structure/demo11.png" width = "50%" height = "50%">
</div>

<p>整个流程就非常清晰了，直到最后一个 inner Modifier 被遍历后便会将 lambda 结果返回给开发者。通过流程的解读，我们可知之所以我们的便利过程没有 CombindedModifier，是因为 CombinedModifier 虽重写了 <strong>foldIn()方法</strong>，但并没有调用我们传入的lambda。而只有所有 Modifier.Element 才会调用我们传入的 lambda。</p>
<p>理解了 <strong>foldIn() 方法</strong> 的实现原理，<strong>foldOut() 方法</strong> 的实现原理是完全相同的，只是遍历顺序是完全相反的，这里就不多加赘述了。</p>
<h3 id="foldin-foldout_2">foldIn() 与 foldOut() 的应用</h3>
<p>弄懂了实现原理后，我们就来看看该怎么用。Compose 源码中将我们所创建的 Modifier 传入 Layout 的过程就是对 <strong>foldIn() 方法</strong> 与 <strong>foldOut() 方法</strong>  的一次最佳实践。</p>
<p>我们知道 Compose 组件都是基于 Layout 这个基础组件实现的，所以我们来看看我们创建的  Modifier 在其中是如何进行传递的。可以发现我们的 modifier 传入了一个名为 <code>materializerOf</code> 方法</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Composable</span> <span class="kd">inline</span> <span class="kd">fun</span> <span class="nf">Layout</span><span class="p">(</span>
    <span class="n">content</span><span class="p">:</span> <span class="nd">@Composable</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Unit</span><span class="p">,</span>
    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="o">=</span> <span class="n">Modifier</span><span class="p">,</span>
    <span class="n">measurePolicy</span><span class="p">:</span> <span class="n">MeasurePolicy</span>
<span class="p">)</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="n">ReusableComposeNode</span><span class="o">&lt;</span><span class="n">ComposeUiNode</span><span class="p">,</span> <span class="n">Applier</span><span class="o">&lt;</span><span class="kt">Any</span><span class="o">&gt;&gt;</span><span class="p">(</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="p">...,</span>
        <span class="n">update</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="p">...</span>
        <span class="p">},</span>
        <span class="n">skippableUpdate</span> <span class="o">=</span> <span class="n">materializerOf</span><span class="p">(</span><span class="n">modifier</span><span class="p">),</span> <span class="c1">// 重点</span>
        <span class="n">content</span> <span class="o">=</span> <span class="p">...</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>继续跟进，我们会走进 Composer.materialize()。可以发现源码中使用了 <strong>fouldIn() 方法</strong>。 在其中我们看到了对于 ComposedModifier 的特殊判断。还记得 <code>composed()</code> 返回的 ComposedModifier 嘛。根据前文我们可知，我们正常得到的 Modifier 链其中是可能包含 ComposedModifier的，而这里想做的是将 Modifier 链中的所有 ComposedModifier 摊平，让其 factory 内部产生的 Modifier 也能加入到 Modifier 链中。</p>
<p>这里使用了 <strong>fouldIn() 方法</strong> 进行了正向遍历，传入的初始值为 Modifier。当遍历到 ComposedModifier 时，则使用其内部的 factory 来生产 Modifier，值得注意的是此时生成的 Modifier 可能也是 Modifier 链或单个 Modifier。生成的 Modifier 其中也可能会包含 ComposedModifier，所以这里就进行了递归处理。最终目标就是所得到的 Modifier 链中是不包含 ComposedModifier 结点的，即完全摊开的 Modifier 链。</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span> <span class="n">Composer</span><span class="p">.</span><span class="nf">materialize</span><span class="p">(</span><span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span><span class="p">):</span> <span class="n">Modifier</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="kd">val</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">modifier</span><span class="p">.</span><span class="na">foldIn</span><span class="o">&lt;</span><span class="n">Modifier</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Modifier</span><span class="p">)</span> <span class="p">{</span> <span class="n">acc</span><span class="p">,</span> <span class="n">element</span> <span class="o">-&gt;</span>
        <span class="n">acc</span><span class="p">.</span><span class="na">then</span><span class="p">(</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">element</span> <span class="k">is</span> <span class="n">ComposedModifier</span><span class="p">)</span> <span class="p">{</span>
                <span class="nd">@kotlin.Suppress</span><span class="p">(</span><span class="s">&quot;UNCHECKED_CAST&quot;</span><span class="p">)</span>
                <span class="kd">val</span> <span class="nv">factory</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="na">factory</span> <span class="k">as</span> <span class="n">Modifier</span><span class="p">.(</span><span class="n">Composer</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Modifier</span>
                <span class="kd">val</span> <span class="nv">composedMod</span> <span class="o">=</span> <span class="n">factory</span><span class="p">(</span><span class="n">Modifier</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span> <span class="c1">// 生产 Modifier</span>
                <span class="n">materialize</span><span class="p">(</span><span class="n">composedMod</span><span class="p">)</span> <span class="c1">// 生成出的 Modifier 可能也包含 ComposedModifier，递归处理</span>
            <span class="p">}</span> <span class="k">else</span> <span class="n">element</span>
        <span class="p">)</span>
    <span class="p">}</span>
        <span class="p">...</span>
    <span class="k">return</span> <span class="n">result</span>
<span class="p">}</span>
</code></pre></div>
<p>Modifier 链后续还会使用 <strong>foldOut方法</strong> 进行遍历从而生成 LayoutNodeWrapper 链，了解 Modifier 链的本质将有助于理解 Jetpack Compose 源码中测量布局流程，感兴趣小伙伴可以拓展阅读文章 <a href="https://juejin.cn/post/6981805443219718151">《Jetpack Compose 测量流程源码分析》</a></p>
<h2 id="_1">总结</h2>
<p>这篇文章的目的就是带领大家对 Modifier 链背后的数据结构与执行逻辑进行分析，使大家对于 Modifier 链的本质有一个清晰的认识。弄清楚了 Modifier 链的本质以后，以后使用 Modifier 出现问题时就容易进行排查了。总之对本质了解的越多，使用起来就越顺手！</p>

  <hr>
<div class="md-source-file">
  <small>
    
      最后更新:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 20, 2021</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="页脚">
      
        
        <a href="../recompose_working_principle/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 重组的工作流程" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              重组的工作流程
            </div>
          </div>
        </a>
      
      
        
        <a href="../../architecture/architecture_for_compose/" class="md-footer__link md-footer__link--next" aria-label="下一页: Compose架构如何选？MVP,MVVM,MVI" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              Compose架构如何选？MVP,MVVM,MVI
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/Compose-Museum/Compose-Tutorial/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>